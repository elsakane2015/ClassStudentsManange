# å¤šæ¬¡è¿Ÿåˆ°/æ—©é€€è®°å½•åŠŸèƒ½å®ŒæˆæŠ¥å‘Š

## âœ… å·²å®Œæˆï¼šæ”¯æŒå¤šæ¬¡è¿Ÿåˆ°å’Œæ—©é€€è®°å½•

### éœ€æ±‚
å­¦ç”Ÿå¯èƒ½åœ¨ä¸€å¤©å†…å¤šæ¬¡è¿Ÿåˆ°æˆ–æ—©é€€ï¼š
- ç¬¬1èŠ‚è¯¾è¿Ÿåˆ°
- ç¬¬5èŠ‚è¯¾åˆè¿Ÿåˆ°
- ç¬¬3èŠ‚è¯¾æ—©é€€
- ç¬¬7èŠ‚è¯¾åˆæ—©é€€

éœ€è¦èƒ½å¤Ÿåˆ†åˆ«è®°å½•æ¯æ¬¡è¿Ÿåˆ°/æ—©é€€çš„å…·ä½“èŠ‚æ¬¡å’Œæ—¶é—´ã€‚

---

## ğŸ”§ å®ç°æ–¹æ¡ˆ

### 1. æ•°æ®åº“é…ç½®æ›´æ–°

åœ¨ `LeaveTypeSeeder.php` ä¸­æ·»åŠ  `require_period` é…ç½®ï¼š

```php
[
    'name' => 'è¿Ÿåˆ°',
    'slug' => 'late',
    'input_type' => 'time',
    'input_config' => json_encode([
        'format' => 'HH:mm',
        'require_period' => true  // â† æ–°å¢ï¼šè¦æ±‚é€‰æ‹©èŠ‚æ¬¡
    ])
],
[
    'name' => 'æ—©é€€',
    'slug' => 'early_leave',
    'input_type' => 'time',
    'input_config' => json_encode([
        'format' => 'HH:mm',
        'require_period' => true  // â† æ–°å¢ï¼šè¦æ±‚é€‰æ‹©èŠ‚æ¬¡
    ])
]
```

### 2. å‰ç«¯UIæ›´æ–°

åœ¨æ—¶é—´è¾“å…¥æ¡†ä¸‹æ–¹æ·»åŠ èŠ‚æ¬¡é€‰æ‹©å™¨ï¼š

```javascript
{config.require_period && (
    <div className="mt-4">
        <label>é€‰æ‹©èŠ‚æ¬¡</label>
        <select onChange={e => setInputData({ ...inputData, period: parseInt(e.target.value) })}>
            <option value="" disabled>è¯·é€‰æ‹©èŠ‚æ¬¡</option>
            {[1, 2, 3, 4, 5, 6, 7, 8].map(p => (
                <option key={p} value={p}>ç¬¬{p}èŠ‚</option>
            ))}
        </select>
    </div>
)}
```

### 3. é€»è¾‘æ›´æ–°

ä½¿ç”¨ç”¨æˆ·é€‰æ‹©çš„èŠ‚æ¬¡ï¼Œè€Œä¸æ˜¯å›ºå®šèŠ‚æ¬¡ï¼š

```javascript
if (details.time) {
    // å¦‚æœç”¨æˆ·é€‰æ‹©äº†èŠ‚æ¬¡ï¼Œä½¿ç”¨ç”¨æˆ·é€‰æ‹©çš„èŠ‚æ¬¡
    if (details.period) {
        periodIds = [details.period];
    } 
    // å¦åˆ™ä½¿ç”¨é»˜è®¤å€¼ï¼ˆå‘åå…¼å®¹ï¼‰
    else if (status === 'late') {
        periodIds = [1];
    } else if (status === 'early_leave') {
        periodIds = [8];
    }
}
```

---

## ğŸ“Š ä½¿ç”¨æµç¨‹

### æ ‡è®°ç¬¬1èŠ‚è¯¾è¿Ÿåˆ°
1. é€‰æ‹©å­¦ç”Ÿ
2. ç‚¹å‡»"è¿Ÿåˆ°"æŒ‰é’®
3. è¾“å…¥æ—¶é—´ï¼š08:30
4. é€‰æ‹©èŠ‚æ¬¡ï¼šç¬¬1èŠ‚
5. ç‚¹å‡»"ç¡®å®š"

**ç»“æœ**ï¼šåˆ›å»ºè®°å½• `(period_id=1, status='late', time='08:30')`

### æ ‡è®°ç¬¬5èŠ‚è¯¾åˆè¿Ÿåˆ°
1. é€‰æ‹©åŒä¸€ä¸ªå­¦ç”Ÿ
2. ç‚¹å‡»"è¿Ÿåˆ°"æŒ‰é’®
3. è¾“å…¥æ—¶é—´ï¼š14:15
4. é€‰æ‹©èŠ‚æ¬¡ï¼šç¬¬5èŠ‚
5. ç‚¹å‡»"ç¡®å®š"

**ç»“æœ**ï¼šåˆ›å»ºè®°å½• `(period_id=5, status='late', time='14:15')`

### æœ€ç»ˆæ˜¾ç¤º
```
[å‡ºå‹¤] | [è¿Ÿåˆ°(08:30)] | [è¿Ÿåˆ°(14:15)]
```

---

## ğŸ¯ æ•°æ®ç»“æ„

### æ•°æ®åº“è®°å½•
```json
[
  {
    "student_id": 1,
    "date": "2025-12-18",
    "period_id": null,
    "status": "present"
  },
  {
    "student_id": 1,
    "date": "2025-12-18",
    "period_id": 1,
    "status": "late",
    "details": {"time": "08:30"}
  },
  {
    "student_id": 1,
    "date": "2025-12-18",
    "period_id": 5,
    "status": "late",
    "details": {"time": "14:15"}
  },
  {
    "student_id": 1,
    "date": "2025-12-18",
    "period_id": 3,
    "status": "early_leave",
    "details": {"time": "10:30"}
  },
  {
    "student_id": 1,
    "date": "2025-12-18",
    "period_id": 7,
    "status": "early_leave",
    "details": {"time": "16:00"}
  }
]
```

### æ˜¾ç¤ºæ•ˆæœ
```
[å‡ºå‹¤] | [è¿Ÿåˆ°(08:30)] | [æ—©é€€(10:30)] | [è¿Ÿåˆ°(14:15)] | [æ—©é€€(16:00)]
```

---

## âœ¨ ä¼˜åŠ¿

### 1. ç²¾ç¡®è®°å½•
- æ¯æ¬¡è¿Ÿåˆ°/æ—©é€€éƒ½æœ‰å…·ä½“çš„èŠ‚æ¬¡å’Œæ—¶é—´
- å¯ä»¥è¿½æº¯å­¦ç”Ÿçš„è¯¦ç»†è€ƒå‹¤æƒ…å†µ

### 2. çµæ´»æ€§
- æ”¯æŒä¸€å¤©å†…å¤šæ¬¡è¿Ÿåˆ°
- æ”¯æŒä¸€å¤©å†…å¤šæ¬¡æ—©é€€
- è¿Ÿåˆ°å’Œæ—©é€€å¯ä»¥å…±å­˜

### 3. å‘åå…¼å®¹
- å¦‚æœä¸é€‰æ‹©èŠ‚æ¬¡ï¼Œä½¿ç”¨é»˜è®¤å€¼
- æ—§æ•°æ®ä»ç„¶å¯ä»¥æ­£å¸¸æ˜¾ç¤º

### 4. æ•°æ®å®Œæ•´æ€§
- æ¯æ¡è®°å½•éƒ½æœ‰å”¯ä¸€çš„ `(student_id, date, period_id)` ç»„åˆ
- ä¸ä¼šç›¸äº’è¦†ç›–

---

## ğŸ§ª æµ‹è¯•åœºæ™¯

### åœºæ™¯1ï¼šå¤šæ¬¡è¿Ÿåˆ°
1. æ ‡è®°"è¿Ÿåˆ°(08:30)"ï¼Œé€‰æ‹©ç¬¬1èŠ‚
2. æ ‡è®°"è¿Ÿåˆ°(14:15)"ï¼Œé€‰æ‹©ç¬¬5èŠ‚
3. âœ… åº”è¯¥æ˜¾ç¤ºä¸¤ä¸ªè¿Ÿåˆ°å¾½ç« 

### åœºæ™¯2ï¼šå¤šæ¬¡æ—©é€€
1. æ ‡è®°"æ—©é€€(10:30)"ï¼Œé€‰æ‹©ç¬¬3èŠ‚
2. æ ‡è®°"æ—©é€€(16:00)"ï¼Œé€‰æ‹©ç¬¬7èŠ‚
3. âœ… åº”è¯¥æ˜¾ç¤ºä¸¤ä¸ªæ—©é€€å¾½ç« 

### åœºæ™¯3ï¼šæ··åˆè®°å½•
1. æ ‡è®°"è¿Ÿåˆ°(08:30)"ï¼Œé€‰æ‹©ç¬¬1èŠ‚
2. æ ‡è®°"æ—©é€€(10:30)"ï¼Œé€‰æ‹©ç¬¬3èŠ‚
3. æ ‡è®°"è¿Ÿåˆ°(14:15)"ï¼Œé€‰æ‹©ç¬¬5èŠ‚
4. æ ‡è®°"æ—©é€€(16:00)"ï¼Œé€‰æ‹©ç¬¬7èŠ‚
5. âœ… åº”è¯¥æ˜¾ç¤º4ä¸ªå¾½ç« ï¼ŒæŒ‰èŠ‚æ¬¡é¡ºåºæ’åˆ—

### åœºæ™¯4ï¼šæ’¤é”€åŠŸèƒ½
1. ç‚¹å‡»ä»»æ„è¿Ÿåˆ°/æ—©é€€å¾½ç« 
2. âœ… åº”è¯¥å¼¹å‡ºç¡®è®¤å¯¹è¯æ¡†
3. ç¡®è®¤åï¼Œè¯¥æ¡è®°å½•è¢«åˆ é™¤
4. âœ… å…¶ä»–è®°å½•ä¸å—å½±å“

---

## ğŸ“ ä¿®æ”¹çš„æ–‡ä»¶

1. âœ… `database/seeders/LeaveTypeSeeder.php`
   - æ·»åŠ  `require_period` é…ç½®

2. âœ… `resources/js/components/AttendanceUpdateModal.jsx`
   - æ·»åŠ èŠ‚æ¬¡é€‰æ‹©å™¨UI
   - æ›´æ–° `periodIds` åˆ†é…é€»è¾‘

---

## ğŸ’¡ æŠ€æœ¯è¦ç‚¹

### å”¯ä¸€æ€§ä¿è¯
é€šè¿‡ `(student_id, date, period_id)` ä¸‰å…ƒç»„ä¿è¯è®°å½•å”¯ä¸€æ€§ï¼š
- åŒä¸€å­¦ç”Ÿã€åŒä¸€å¤©ã€åŒä¸€èŠ‚æ¬¡åªèƒ½æœ‰ä¸€æ¡è®°å½•
- ä¸åŒèŠ‚æ¬¡å¯ä»¥æœ‰å¤šæ¡è®°å½•

### UI/UXè®¾è®¡
- æ—¶é—´è¾“å…¥æ¡†ï¼šå¿…å¡«
- èŠ‚æ¬¡é€‰æ‹©å™¨ï¼šå¿…é€‰ï¼ˆå½“ `require_period=true` æ—¶ï¼‰
- é»˜è®¤æç¤ºï¼š"è¯·é€‰æ‹©èŠ‚æ¬¡"

### æ•°æ®æµ
```
ç”¨æˆ·è¾“å…¥ â†’ inputData {time, period}
         â†“
executeBulkUpdate(status, leaveTypeId, inputData)
         â†“
periodIds = [inputData.period]
         â†“
åç«¯åˆ›å»ºè®°å½• (period_id=inputData.period)
```

---

*å®Œæˆæ—¶é—´: 2025-12-18 13:04*
*åŠŸèƒ½: å¤šæ¬¡è¿Ÿåˆ°/æ—©é€€è®°å½•*
*çŠ¶æ€: âœ… å·²å®Œæˆ*
