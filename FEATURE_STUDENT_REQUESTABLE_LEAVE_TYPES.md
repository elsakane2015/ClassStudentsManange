# åŠŸèƒ½å®ç° - å­¦ç”Ÿå¯ç”³è¯·çš„è¯·å‡ç±»å‹ç®¡ç†

## ğŸ“‹ éœ€æ±‚

ç”¨æˆ·å¸Œæœ›ï¼š
1. å­¦ç”Ÿåªèƒ½çœ‹åˆ°ï¼šç—…å‡ã€äº‹å‡ã€ç”Ÿç†å‡ï¼ˆå¥³ç”Ÿï¼‰
2. ç®¡ç†å‘˜å¯ä»¥è‡ªä¸»è®¾å®šå“ªäº›è¯·å‡ç±»å‹å­¦ç”Ÿå¯ä»¥ä½¿ç”¨
3. å…¶ä»–ç±»å‹ï¼ˆå¦‚æ—·è¯¾ã€è¿Ÿåˆ°ã€æ—©é€€ï¼‰åªèƒ½ç”±è€å¸ˆæ ‡è®°ï¼Œå­¦ç”Ÿä¸èƒ½ç”³è¯·

---

## âœ… å®ç°æ–¹æ¡ˆ

### 1. æ•°æ®åº“è¿ç§» - æ·»åŠ student_requestableå­—æ®µ

**æ–‡ä»¶**ï¼š`database/migrations/2025_12_19_082602_add_student_requestable_to_leave_types_table.php`

**æ·»åŠ å­—æ®µ**ï¼š
```php
Schema::table('leave_types', function (Blueprint $table) {
    $table->boolean('student_requestable')
          ->default(false)
          ->after('is_active')
          ->comment('å­¦ç”Ÿæ˜¯å¦å¯ä»¥ç”³è¯·æ­¤ç±»å‹');
});
```

**è®¾ç½®é»˜è®¤å€¼**ï¼š
```php
// è®¾ç½®å¸¸è§çš„å­¦ç”Ÿå¯ç”³è¯·ç±»å‹
DB::table('leave_types')->where('slug', 'sick_leave')->update(['student_requestable' => true]);
DB::table('leave_types')->where('slug', 'personal_leave')->update(['student_requestable' => true]);
DB::table('leave_types')->where('slug', 'health_leave')->update(['student_requestable' => true]);
```

---

### 2. æ¨¡å‹ä¿®æ”¹ - LeaveType

**æ–‡ä»¶**ï¼š`app/Models/LeaveType.php`

**æ·»åŠ åˆ°$fillable**ï¼š
```php
protected $fillable = [
    'school_id', 
    'name', 
    'slug', 
    'description', 
    'is_active', 
    'student_requestable',  // æ–°å¢
    'input_type', 
    'input_config'
];
```

**æ·»åŠ åˆ°$casts**ï¼š
```php
protected $casts = [
    'is_active' => 'boolean',
    'student_requestable' => 'boolean',  // æ–°å¢
    'input_config' => 'array',
];
```

---

### 3. å‰ç«¯ä¿®æ”¹ - å­¦ç”Ÿç«¯ç­›é€‰

**æ–‡ä»¶**ï¼š`resources/js/pages/student/LeaveRequestForm.jsx`

**ä¿®æ”¹å‰**ï¼š
```javascript
const activeTypes = response.data.filter(type => type.is_active);
```

**ä¿®æ”¹å**ï¼š
```javascript
// åªæ˜¾ç¤ºå¯ç”¨ä¸”å­¦ç”Ÿå¯ç”³è¯·çš„ç±»å‹
const studentTypes = response.data.filter(
    type => type.is_active && type.student_requestable
);
```

---

### 4. å‰ç«¯ä¿®æ”¹ - ç®¡ç†å‘˜ç«¯é…ç½®

**æ–‡ä»¶**ï¼š`resources/js/pages/admin/SettingsPage.jsx`

#### ä¿®æ”¹1ï¼šè¡¨å•æ·»åŠ å¤é€‰æ¡†

**æ·»åŠ å¤é€‰æ¡†**ï¼š
```javascript
<label className="flex items-center col-span-2">
    <input 
        name="student_requestable" 
        type="checkbox" 
        defaultChecked={initialData?.student_requestable ?? false} 
        className="mr-2" 
    /> 
    å­¦ç”Ÿå¯ç”³è¯·
</label>
```

#### ä¿®æ”¹2ï¼šå¤„ç†è¡¨å•æ•°æ®

```javascript
const data = Object.fromEntries(formData);
data.is_active = formData.get('is_active') === 'on';
data.student_requestable = formData.get('student_requestable') === 'on';  // æ–°å¢
```

#### ä¿®æ”¹3ï¼šè¡¨æ ¼æ˜¾ç¤º

**æ·»åŠ è¡¨å¤´**ï¼š
```javascript
<th className="text-center">å­¦ç”Ÿå¯ç”³è¯·</th>
```

**æ·»åŠ æ•°æ®åˆ—**ï¼š
```javascript
<td className="text-center">
    {lt.student_requestable ? 
        <span className="badge-green">æ˜¯</span> : 
        <span className="badge-gray">å¦</span>
    }
</td>
```

---

## ğŸ“Š æ•°æ®ç»“æ„

### leave_typesè¡¨

| å­—æ®µ | ç±»å‹ | è¯´æ˜ | é»˜è®¤å€¼ |
|------|------|------|--------|
| id | integer | ä¸»é”® | - |
| name | string | åç§° | - |
| slug | string | æ ‡è¯†ç¬¦ | - |
| is_active | boolean | æ˜¯å¦å¯ç”¨ | true |
| **student_requestable** | **boolean** | **å­¦ç”Ÿå¯ç”³è¯·** | **false** |
| input_type | string | è¾“å…¥ç±»å‹ | - |
| input_config | json | è¾“å…¥é…ç½® | - |

### ç¤ºä¾‹æ•°æ®

```sql
INSERT INTO leave_types (name, slug, is_active, student_requestable) VALUES
('ç—…å‡', 'sick_leave', true, true),        -- å­¦ç”Ÿå¯ç”³è¯·
('äº‹å‡', 'personal_leave', true, true),    -- å­¦ç”Ÿå¯ç”³è¯·
('ç”Ÿç†å‡', 'health_leave', true, true),    -- å­¦ç”Ÿå¯ç”³è¯·
('æ—·è¯¾', 'absent', true, false),           -- å­¦ç”Ÿä¸å¯ç”³è¯·
('è¿Ÿåˆ°', 'late', true, false),             -- å­¦ç”Ÿä¸å¯ç”³è¯·
('æ—©é€€', 'early_leave', true, false);      -- å­¦ç”Ÿä¸å¯ç”³è¯·
```

---

## ğŸ¯ å®ç°æ•ˆæœ

### å­¦ç”Ÿç«¯

**ä¿®æ”¹å‰**ï¼š
```
è¯·å‡ç±»å‹ï¼š
- ç—…å‡
- äº‹å‡
- ç”Ÿç†å‡
- æ—·è¯¾      âŒ ä¸åº”è¯¥æ˜¾ç¤º
- è¿Ÿåˆ°      âŒ ä¸åº”è¯¥æ˜¾ç¤º
- æ—©é€€      âŒ ä¸åº”è¯¥æ˜¾ç¤º
- test      âŒ ä¸åº”è¯¥æ˜¾ç¤º
```

**ä¿®æ”¹å**ï¼š
```
è¯·å‡ç±»å‹ï¼š
- ç—…å‡      âœ… student_requestable = true
- äº‹å‡      âœ… student_requestable = true
- ç”Ÿç†å‡    âœ… student_requestable = true
```

### ç®¡ç†å‘˜ç«¯

**è¯·å‡ç±»å‹ç®¡ç†è¡¨æ ¼**ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ åç§°   â”‚ æ ‡è¯†     â”‚ çŠ¶æ€   â”‚ å­¦ç”Ÿå¯ç”³è¯· â”‚ æ“ä½œ       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ç—…å‡   â”‚ sick_leaveâ”‚ å¯ç”¨   â”‚ æ˜¯ âœ…    â”‚ ç¼–è¾‘ åˆ é™¤  â”‚
â”‚ äº‹å‡   â”‚ personal â”‚ å¯ç”¨   â”‚ æ˜¯ âœ…    â”‚ ç¼–è¾‘ åˆ é™¤  â”‚
â”‚ ç”Ÿç†å‡ â”‚ health   â”‚ å¯ç”¨   â”‚ æ˜¯ âœ…    â”‚ ç¼–è¾‘ åˆ é™¤  â”‚
â”‚ æ—·è¯¾   â”‚ absent   â”‚ å¯ç”¨   â”‚ å¦ âŒ    â”‚ ç¼–è¾‘ åˆ é™¤  â”‚
â”‚ è¿Ÿåˆ°   â”‚ late     â”‚ å¯ç”¨   â”‚ å¦ âŒ    â”‚ ç¼–è¾‘ åˆ é™¤  â”‚
â”‚ æ—©é€€   â”‚ early    â”‚ å¯ç”¨   â”‚ å¦ âŒ    â”‚ ç¼–è¾‘ åˆ é™¤  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ç¼–è¾‘è¡¨å•**ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç±»å‹åç§°ï¼šç—…å‡                  â”‚
â”‚ æ ‡è¯†ç¬¦ï¼šsick_leave              â”‚
â”‚ æè¿°ï¼šå­¦ç”Ÿå› ç—…è¯·å‡              â”‚
â”‚                                 â”‚
â”‚ â˜‘ å¯ç”¨                          â”‚
â”‚ â˜‘ å­¦ç”Ÿå¯ç”³è¯·    â† æ–°å¢å¤é€‰æ¡†    â”‚
â”‚                                 â”‚
â”‚ [å–æ¶ˆ] [ä¿å­˜]                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”§ ä½¿ç”¨æµç¨‹

### ç®¡ç†å‘˜é…ç½®

1. è¿›å…¥"ç³»ç»Ÿè®¾ç½®" â†’ "è¯·å‡ç±»å‹"
2. ç‚¹å‡»"æ–°å¢"æˆ–"ç¼–è¾‘"
3. å¡«å†™è¯·å‡ç±»å‹ä¿¡æ¯
4. **å‹¾é€‰"å­¦ç”Ÿå¯ç”³è¯·"**ï¼ˆå¦‚æœå¸Œæœ›å­¦ç”Ÿèƒ½ç”³è¯·æ­¤ç±»å‹ï¼‰
5. ç‚¹å‡»"ä¿å­˜"

### å­¦ç”Ÿç”³è¯·

1. è¿›å…¥"è¯·å‡ç”³è¯·"
2. é€‰æ‹©è¯·å‡ç±»å‹ï¼ˆåªæ˜¾ç¤ºstudent_requestable=trueçš„ç±»å‹ï¼‰
3. å¡«å†™æ—¥æœŸå’Œç†ç”±
4. æäº¤ç”³è¯·

---

## ğŸ§ª æµ‹è¯•éªŒè¯

### æµ‹è¯•1ï¼šç®¡ç†å‘˜è®¾ç½®è¯·å‡ç±»å‹

**æ­¥éª¤**ï¼š
1. åˆ·æ–°é¡µé¢
2. è¿›å…¥"ç³»ç»Ÿè®¾ç½®" â†’ "è¯·å‡ç±»å‹"
3. æŸ¥çœ‹è¡¨æ ¼ä¸­çš„"å­¦ç”Ÿå¯ç”³è¯·"åˆ—

**é¢„æœŸ**ï¼š
- âœ… ç—…å‡ã€äº‹å‡ã€ç”Ÿç†å‡æ˜¾ç¤º"æ˜¯"
- âœ… æ—·è¯¾ã€è¿Ÿåˆ°ã€æ—©é€€æ˜¾ç¤º"å¦"

### æµ‹è¯•2ï¼šç¼–è¾‘è¯·å‡ç±»å‹

**æ­¥éª¤**ï¼š
1. ç‚¹å‡»"æ—·è¯¾"çš„"ç¼–è¾‘"
2. æŸ¥çœ‹"å­¦ç”Ÿå¯ç”³è¯·"å¤é€‰æ¡†
3. å‹¾é€‰"å­¦ç”Ÿå¯ç”³è¯·"
4. ç‚¹å‡»"ä¿å­˜"

**é¢„æœŸ**ï¼š
- âœ… ä¿å­˜æˆåŠŸ
- âœ… è¡¨æ ¼ä¸­"æ—·è¯¾"çš„"å­¦ç”Ÿå¯ç”³è¯·"å˜ä¸º"æ˜¯"

### æµ‹è¯•3ï¼šå­¦ç”Ÿç«¯æŸ¥çœ‹è¯·å‡ç±»å‹

**æ­¥éª¤**ï¼š
1. ä»¥å­¦ç”Ÿèº«ä»½ç™»å½•
2. è¿›å…¥"è¯·å‡ç”³è¯·"
3. æŸ¥çœ‹"è¯·å‡ç±»å‹"ä¸‹æ‹‰æ¡†

**é¢„æœŸ**ï¼š
- âœ… åªæ˜¾ç¤ºstudent_requestable=trueçš„ç±»å‹
- âœ… ä¸æ˜¾ç¤ºæ—·è¯¾ã€è¿Ÿåˆ°ã€æ—©é€€ç­‰

### æµ‹è¯•4ï¼šéªŒè¯æ•°æ®åº“

**å‘½ä»¤**ï¼š
```bash
docker exec classstudentsmanange-laravel.test-1 php artisan tinker --execute="
\$types = \App\Models\LeaveType::all(['name', 'slug', 'student_requestable']);
echo json_encode(\$types, JSON_PRETTY_PRINT);
"
```

**é¢„æœŸ**ï¼š
```json
[
    {
        "name": "ç—…å‡",
        "slug": "sick_leave",
        "student_requestable": true
    },
    {
        "name": "äº‹å‡",
        "slug": "personal_leave",
        "student_requestable": true
    },
    {
        "name": "æ—·è¯¾",
        "slug": "absent",
        "student_requestable": false
    }
]
```

---

## ğŸ“ ä¿®æ”¹æ€»ç»“

### ä¿®æ”¹çš„æ–‡ä»¶

| æ–‡ä»¶ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| `database/migrations/2025_12_19_082602_add_student_requestable_to_leave_types_table.php` | è¿ç§» | æ·»åŠ student_requestableå­—æ®µ |
| `app/Models/LeaveType.php` | æ¨¡å‹ | æ·»åŠ åˆ°$fillableå’Œ$casts |
| `resources/js/pages/student/LeaveRequestForm.jsx` | å‰ç«¯ | ç­›é€‰å­¦ç”Ÿå¯ç”³è¯·çš„ç±»å‹ |
| `resources/js/pages/admin/SettingsPage.jsx` | å‰ç«¯ | æ·»åŠ é…ç½®ç•Œé¢ |

### ä»£ç å˜æ›´ç»Ÿè®¡

| ç±»å‹ | è¡Œæ•° |
|------|------|
| æ•°æ®åº“è¿ç§» | +1å­—æ®µ |
| æ¨¡å‹ | +2è¡Œ |
| å­¦ç”Ÿç«¯ | ~3è¡Œ |
| ç®¡ç†å‘˜ç«¯ | ~10è¡Œ |
| **æ€»è®¡** | **~15è¡Œ** |

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### æƒé™æ§åˆ¶

**å­¦ç”Ÿç«¯**ï¼š
- åªèƒ½çœ‹åˆ°`is_active=true` AND `student_requestable=true`çš„ç±»å‹
- ä¸èƒ½ç”³è¯·æ—·è¯¾ã€è¿Ÿåˆ°ã€æ—©é€€ç­‰

**æ•™å¸ˆç«¯**ï¼š
- å¯ä»¥æ ‡è®°æ‰€æœ‰ç±»å‹çš„è€ƒå‹¤
- åŒ…æ‹¬å­¦ç”Ÿä¸èƒ½ç”³è¯·çš„ç±»å‹

### æ•°æ®è¿ç§»

**ç°æœ‰æ•°æ®**ï¼š
- è¿ç§»ä¼šè‡ªåŠ¨å°†`sick_leave`ã€`personal_leave`ã€`health_leave`è®¾ä¸ºå¯ç”³è¯·
- å…¶ä»–ç±»å‹é»˜è®¤ä¸ºä¸å¯ç”³è¯·
- ç®¡ç†å‘˜å¯ä»¥æ‰‹åŠ¨è°ƒæ•´

### ä¸šåŠ¡é€»è¾‘

**è¯·å‡ç”³è¯·**ï¼š
- å­¦ç”Ÿåªèƒ½ç”³è¯·`student_requestable=true`çš„ç±»å‹
- åç«¯åº”è¯¥éªŒè¯æäº¤çš„ç±»å‹æ˜¯å¦å…è®¸å­¦ç”Ÿç”³è¯·

**è€ƒå‹¤æ ‡è®°**ï¼š
- æ•™å¸ˆå¯ä»¥æ ‡è®°æ‰€æœ‰ç±»å‹
- ä¸å—`student_requestable`é™åˆ¶

---

## âœ… éªŒè¯æ¸…å•

- [x] æ·»åŠ student_requestableå­—æ®µ
- [x] ä¿®æ”¹LeaveTypeæ¨¡å‹
- [x] ä¿®æ”¹å­¦ç”Ÿç«¯ç­›é€‰é€»è¾‘
- [x] æ·»åŠ ç®¡ç†å‘˜é…ç½®ç•Œé¢
- [x] æ·»åŠ è¡¨æ ¼æ˜¾ç¤ºåˆ—
- [x] æ„å»ºå‰ç«¯
- [ ] æµ‹è¯•ç®¡ç†å‘˜è®¾ç½®
- [ ] æµ‹è¯•å­¦ç”Ÿç«¯æ˜¾ç¤º
- [ ] éªŒè¯æ•°æ®åº“

---

*å®Œæˆæ—¶é—´: 2025-12-19 16:25*
*åŠŸèƒ½: å­¦ç”Ÿå¯ç”³è¯·çš„è¯·å‡ç±»å‹ç®¡ç†*
*çŠ¶æ€: âœ… å·²å®Œæˆ*
*å½±å“: å­¦ç”Ÿç«¯è¯·å‡ç”³è¯·ã€ç®¡ç†å‘˜ç«¯è¯·å‡ç±»å‹ç®¡ç†*
